pipeline {
  agent any
  tools {
        maven 'Maven 3.8.5' // Name from Jenkins Global Tool Config
        jdk 'JDK 11'        // Name from Jenkins Global Tool Config
    }

    environment {
        ARTIFACTORY_SERVER_ID = 'https:///artifactory/api/maven/my-java-app-libs-snapshot' // Jenkins Artifactory Server ID
    }
  stages{
    stage('Clone Repo') {
            steps {
                script {
                    git branch: "${params.GIT_BRANCH}",
                        credentialsId: 'github-cred-id',
                        url: "${params.GIT_URL}"
                }
            }
        }
    stage('Build & Deploy') {
            steps {
                script {
                    def server = Artifactory.server(ARTIFACTORY_SERVER_ID)

                    def buildInfo = server.mavenBuild(
                        tool: 'Maven 3.8.5',
                        pom: 'pom.xml',
                        goals: 'clean install deploy',
                        buildInfo: true,
                        resolver: [
                            repo: 'my-java-app',
                            serverId: ARTIFACTORY_SERVER_ID
                        ],
                        deployer: [
                            repo: 'my-java-app',
                            serverId: ARTIFACTORY_SERVER_ID
                        ]
                    )

                    server.publishBuildInfo buildInfo
                }
            }
        }
  }
  
    
}
